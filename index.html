<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Typing Game Song Ng·ªØ</title>
<style>
body{font-family:sans-serif;background:linear-gradient(120deg,#f6d365,#fda085);padding:20px;}
.card{background:#fff;border-radius:15px;box-shadow:0 4px 12px rgba(0,0,0,0.2);padding:20px;max-width:700px;margin:auto;}
h2{text-align:center;background:linear-gradient(to right,#ff416c,#ff4b2b);-webkit-background-clip:text;color:transparent;font-size:28px;}
.row{display:flex;gap:10px;margin:10px 0;}
button{padding:10px 14px;border:0;border-radius:6px;background:#2b8cff;color:#fff;cursor:pointer;transition:0.3s;}
button:hover{background:#1a6ed8;transform:scale(1.05);}
button.secondary{background:#777;}
button.secondary:hover{background:#555;}
input{flex:1;padding:8px;font-size:16px;border:2px solid #ccc;border-radius:6px;transition:0.3s;}
input:focus{border-color:#2b8cff;outline:none;box-shadow:0 0 5px #2b8cff;}
.result{margin-top:10px;white-space:pre-line;font-size:18px;font-weight:bold;}
.result.correct{color:green;}
.result.wrong{color:red;}
.prompt-noun{color:#2b8cff;}
.prompt-verb{color:#ff6600;}
.prompt-adj{color:#8000ff;}
#progress{text-align:right;font-weight:bold;margin-bottom:10px;color:#333;}
#timer{text-align:right;margin-bottom:10px;color:#333;}
#finalResult{display:none;margin-top:20px;padding:15px;background:#f9f9f9;border:2px solid #ddd;border-radius:10px;font-size:18px;}
</style>
</head>
<body>
<div class="card" id="app">
<h2>Typing Game Song Ng·ªØ</h2>
<div id="menu">
<p>Ch·ªçn b·ªô t·ª´:</p>
<button onclick="startGame('noun')">Danh t·ª´</button>
<button onclick="startGame('verb')">ƒê·ªông t·ª´</button>
<button onclick="startGame('adj')">T√≠nh t·ª´</button>
</div>

<div id="game" style="display:none;">
<div id="progress"></div>
<div id="timer"></div>
<div id="prompt" style="font-size:20px;font-weight:bold;margin:10px 0;"></div>
<div class="row"><input id="inputWord" placeholder="Nh·∫≠p t·ª´..." /></div>
<div class="row"><input id="inputSyll" placeholder="S·ªë √¢m ti·∫øt (t√πy ch·ªçn)" /></div>
<div class="row">
<button onclick="checkWord()">Ki·ªÉm tra</button>
<button class="secondary" onclick="speakWord()">üîä Ph√°t √¢m</button>
<button class="secondary" onclick="startVoice()">üé§ Voice Input</button>
<button class="secondary" onclick="backMenu()">‚§∫ Quay l·∫°i</button>
</div>
<div class="result" id="result"></div>
<div id="finalResult"></div>
</div>
</div>

<audio id="sound-correct" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="sound-wrong" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

<script>
// ===== Word Sets Song Ng·ªØ
const wordSets={
  "noun":{
    "h√†nh ƒë·ªông":["action","h√†nh ƒë·ªông"],
    "ho·∫°t ƒë·ªông":["activity","ho·∫°t ƒë·ªông"],
    "l·ªùi khuy√™n":["advice","l·ªùi khuy√™n"],
    "m·ª•c ti√™u":["aim","m·ª•c ti√™u"],
    "thi·∫øt b·ªã":["appliance","thi·∫øt b·ªã"],
    "b·∫ßu kh√¥ng kh√≠":["atmosphere","b·∫ßu kh√¥ng kh√≠"],
    "khu v·ª±c":["area","khu v·ª±c"],
    "nh·∫≠n th·ª©c":["awareness","nh·∫≠n th·ª©c"],
    "chai l·ªç":["bottle","chai l·ªç"],
    "c√°i th√πng":["bin","c√°i th√πng"],
    "d·∫•u ch√¢n cacbon":["carbon footprint","d·∫•u ch√¢n cacbon"],
    "l·ªÖ k·ªâ ni·ªám":["ceremony","l·ªÖ k·ªâ ni·ªám"],
    "s·ª± thay ƒë·ªïi":["change","s·ª± thay ƒë·ªïi"],
    "h√≥a ch·∫•t":["chemical","h√≥a ch·∫•t"],
    "c√¢u l·∫°c b·ªô":["club","c√¢u l·∫°c b·ªô"],
    "t·ªïn h·∫°i":["damage","t·ªïn h·∫°i"],
    "thi·∫øt b·ªã":["device","thi·∫øt b·ªã"],
    "s·ª± kh√°c bi·ªát":["difference","s·ª± kh√°c bi·ªát"],
    "ƒëi·ªán":["electricity","ƒëi·ªán"],
    "s·ª± th·∫£i ra":["emission","s·ª± th·∫£i ra"],
    "nƒÉng l∆∞·ª£ng":["energy","nƒÉng l∆∞·ª£ng"],
    "m√¥i tr∆∞·ªùng":["environment","m√¥i tr∆∞·ªùng"],
    "bu·ªïi tri·ªÉn l√£m":["exhibition","bu·ªïi tri·ªÉn l√£m"],
    "v·ª• n·ªï":["explosion","v·ª• n·ªï"],
    "th√πng r√°c":["garbage can","th√πng r√°c"],
    "th√≥i quen":["habit","th√≥i quen"],
    "v·∫•n ƒë·ªÅ":["issue","v·∫•n ƒë·ªÅ"],
    "v·∫≠n d·ª•ng":["item","v·∫≠n d·ª•ng"],
    "l·ªëi s·ªëng":["lifestyle","l·ªëi s·ªëng c√°ch s·ªëng"],
    "nguy√™n li·ªáu":["material","nguy√™n li·ªáu"],
    "ph∆∞∆°ng ph√°p":["method","ph∆∞∆°ng ph√°p"],
    "ngu·ªìn t√†i nguy√™n":["natural resources","ngu·ªìn t√†i nguy√™n thi√™n nhi√™n"],
    "khu x√≥m":["neighborhood","khu x√≥m"],
    "s·ª± √¥ nhi·ªÖm":["pollution","s·ª± √¥ nhi·ªÖm"],
    "s·∫£n ph·∫©m":["product","s·∫£n ph·∫©m"],
    "ph∆∞∆°ng ti·ªán c√¥ng c·ªông":["public transport","ph∆∞∆°ng ti·ªán c√¥ng c·ªông"],
    "b√≥ng r√¢m":["shade","b√≥ng r√¢m"],
    "t√¨nh hu·ªëng":["situation","t√¨nh hu·ªëng"],
    "l·ªùi ƒë·ªÅ ngh·ªã":["suggestion","l·ªùi ƒë·ªÅ ngh·ªã"],
    "nhi·ªát ƒë·ªô":["temperature","nhi·ªát ƒë·ªô"],
    "chai l·ªç":["trash","chai l·ªç"]
  },
  "verb":{
    "ƒë·∫°t ƒë∆∞·ª£c":["achieve","ƒë·∫°t ƒë∆∞·ª£c"],
    "tham d·ª±":["attend","tham d·ª±"],
    "d·ª±a tr√™n":["base on","d·ª±a tr√™n"],
    "c√≥ th·ªÉ":["be able to","c√≥ th·ªÉ"],
    "t·ª± h√†o v·ªÅ":["be proud of","t·ª± h√†o v·ªÅ"],
    "ch·ªãu tr√°ch nhi·ªám":["be responsible for","ch·ªãu tr√°ch nhi·ªám"],
    "d·ªçn d·∫πp":["clear up","d·ªçn d·∫πp"],
    "s∆∞u t·∫ßm":["collect","s∆∞u t·∫ßm"],
    "t·∫°o ra":["create","t·∫°o ra"],
    "c·∫Øt gi·∫£m":["cut down on","c·∫Øt gi·∫£m"],
    "khuy·∫øn kh√≠ch":["encourage","khuy·∫øn kh√≠ch"],
    "∆∞·ªõc t√≠nh":["estimate","∆∞·ªõc t√≠nh"],
    "g√¢y h·∫°i":["harm","g√¢y h·∫°i"],
    "c·∫£i thi·ªán":["improve","c·∫£i thi·ªán"],
    "tham gia":["join","tham gia"],
    "d·∫´n ƒë·∫øn":["lead","d·∫´n ƒë·∫øn"],
    "x·∫£ r√°c":["litter","x·∫£ r√°c"],
    "ch·ªçn theo":["adopt","ch·ªçn theo"],
    "chia nh·ªè":["break down","chia nh·ªè"],
    "t·ªï ch·ª©c":["organize","t·ªï ch·ª©c"],
    "nh·∫∑t":["pick up","nh·∫∑t"],
    "s·∫£n xu·∫•t ra":["produce","s·∫£n xu·∫•t ra"],
    "b·∫£o v·ªá":["protect","b·∫£o v·ªá"],
    "cung c·∫•p":["provide","cung c·∫•p"],
    "l√†m gia tƒÉng":["raise","l√†m gia tƒÉng"],
    "t√°i ch·∫ø":["recycle","t√°i ch·∫ø"],
    "l√†m gi·∫£m":["reduce","l√†m gi·∫£m"],
    "th√†nh l·∫≠p":["set up","th√†nh l·∫≠p"],
    "t·∫Øt":["turn off","t·∫Øt"],
    "l√£ng ph√≠":["waste","l√£ng ph√≠"],
    "tham gia":["take part in","tham gia"]
  },
  "adj":{
    "nguy hi·ªÉm":["dangerous","nguy hi·ªÉm"],
    "d∆° b·∫©n":["dirty","d∆° b·∫©n"],
    "th√¢n thi·ªán m√¥i tr∆∞·ªùng":["eco-friendly","th√¢n thi·ªán m√¥i tr∆∞·ªùng"],
    "thu·ªôc v·ªÅ ƒëi·ªán":["electrical","thu·ªôc v·ªÅ ƒëi·ªán"],
    "thu·ªôc v·ªÅ m√¥i tr∆∞·ªùng":["environmental","thu·ªôc v·ªÅ m√¥i tr∆∞·ªùng"],
    "to√†n c·∫ßu":["global","to√†n c·∫ßu"],
    "ƒë·ªôc h·∫°i":["harmful","ƒë·ªôc h·∫°i"],
    "t·ª± nhi√™n":["natural","t·ª± nhi√™n"],
    "h·ªØu c∆°":["organic","h·ªØu c∆°"],
    "c√° nh√¢n":["personal","c√° nh√¢n"],
    "b·ªã √¥ nhi·ªÖm":["polluted","b·ªã √¥ nhi·ªÖm"],
    "ch∆∞a qua ch·∫ø bi·∫øn":["raw","ch∆∞a qua ch·∫ø bi·∫øn"],
    "c√≥ th·ªÉ l√†m ƒë·∫ßy l·∫°i":["refillable","c√≥ th·ªÉ l√†m ƒë·∫ßy l·∫°i"],
    "c√≥ th·ªÉ t√°i s·ª≠ d·ª•ng":["reusable","c√≥ th·ªÉ t√°i s·ª≠ d·ª•ng"],
    "b·ªÅn v·ªØng":["sustainable","b·ªÅn v·ªØng"]
  }
};

// ===== Variables
let currentSet={},wordList=[],index=0,reviewList=[],currentCat="";
let correctCount=0,wrongCount=0,allWrongList=[];
let timerInterval;

// ===== Game Functions
function startGame(cat){
  currentSet=wordSets[cat];
  currentCat=cat;
  wordList=Object.keys(currentSet);
  shuffle(wordList);
  index=0; reviewList=[]; correctCount=0; wrongCount=0; allWrongList=[];
  document.getElementById("menu").style.display="none";
  document.getElementById("game").style.display="block";
  document.getElementById("finalResult").style.display="none";
  showWord();
}
function backMenu(){document.getElementById("menu").style.display="block";document.getElementById("game").style.display="none";}

function showWord(){
  if(index>=wordList.length){
    if(reviewList.length){wordList=reviewList; reviewList=[]; shuffle(wordList); index=0; document.getElementById("result").innerText="üîÑ √în t·∫≠p t·ª´ sai..."; setTimeout(showWord,800); return;}
    else {showFinalResult(); return;}
  }
  const current=wordList[index];
  const promptEl=document.getElementById("prompt");
  const progressEl=document.getElementById("progress");
  progressEl.innerText=`T·ª´ ${index+1} / ${wordList.length}`;
  // Random Vi·ªát ‚Üî Anh
  const showVi=Math.random()<0.5;
  if(showVi){promptEl.innerText=current; promptEl.dataset.expect="en";}
  else{promptEl.innerText=currentSet[current][0]; promptEl.dataset.expect="vi";}
  promptEl.className="";
  if(currentCat=="noun") promptEl.classList.add("prompt-noun");
  if(currentCat=="verb") promptEl.classList.add("prompt-verb");
  if(currentCat=="adj") promptEl.classList.add("prompt-adj");
  // Timer
  let timeLeft=60;
  document.getElementById("timer").innerText=`Th·ªùi gian: ${timeLeft}s`;
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{timeLeft--; document.getElementById("timer").innerText=`Th·ªùi gian: ${timeLeft}s`;
  if(timeLeft<=0){clearInterval(timerInterval); wrongAnswer("H·∫øt gi·ªù"); index++; setTimeout(showWord,1000);}},1000);
}

function speakWord(){
  if(index>=wordList.length) return;
  const current=wordList[index];
  const text=currentSet[current][0];
  let u=new SpeechSynthesisUtterance(text);
  u.lang="en-US"; speechSynthesis.speak(u);
}

function startVoice(){
  if(!('webkitSpeechRecognition' in window)){alert("Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ voice."); return;}
  const recognition=new webkitSpeechRecognition();
  recognition.lang='en-US'; recognition.start();
  recognition.onresult=function(event){
    document.getElementById("inputWord").value=event.results[0][0].transcript;
  }
}

function shuffle(arr){for(let i=arr.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]];}}

async function getSyllables(word){
  try{
    const res=await fetch(`https://api.datamuse.com/words?sp=${word}&md=s`);
    const data=await res.json();
    if(data[0] && data[0].numSyllables) return data[0].numSyllables.toString();
  }catch(e){}
  return "1";
}

async function checkWord(){
  clearInterval(timerInterval);
  const userWord=document.getElementById("inputWord").value.trim().toLowerCase();
  const userSyll=document.getElementById("inputSyll").value.trim();
  const current=wordList[index];
  let correct, correctSyll="";
  if(document.getElementById("prompt").dataset.expect=="en"){
    correct=currentSet[current][0].toLowerCase();
    correctSyll=await getSyllables(correct);
  }else{
    correct=currentSet[current][1].toLowerCase();
  }

  if(userWord==correct && (userSyll=="" || userSyll==correctSyll)){
    document.getElementById("result").className="result correct";
    document.getElementById("result").innerText=`‚úÖ ƒê√∫ng! ${correctSyll?`(${correctSyll} √¢m ti·∫øt)`:""}`;
    document.getElementById("sound-correct").play();
    correctCount++;
  }else{ wrongAnswer(correct,correctSyll); }

  document.getElementById("inputWord").value="";
  document.getElementById("inputSyll").value="";
  index++; setTimeout(showWord,1000);
}

function wrongAnswer(correct,syl=""){ 
  document.getElementById("result").className="result wrong";
  document.getElementById("result").innerText=`‚ùå Sai! ƒê√°p √°n: ${correct} ${syl?`(${syl} √¢m ti·∫øt)`:""}`;
  document.getElementById("sound-wrong").play();
  wrongCount++; 
  if(!reviewList.includes(wordList[index])) reviewList.push(wordList[index]);
  if(!allWrongList.includes(wordList[index])) allWrongList.push(wordList[index]);
}

function showFinalResult(){
  let finalBox=document.getElementById("finalResult");
  finalBox.style.display="block";
  let html=`üìä K·∫øt qu·∫£:<br>‚úÖ ƒê√∫ng: ${correctCount}<br>‚ùå Sai: ${wrongCount}<br><br>`;
  if(wrongCount>0){html+="üìñ C√°c t·ª´ sai:<br>";
    for(let key in currentSet){if(allWrongList.includes(key)) html+=`- <b>${currentSet[key][0]}</b> : ${key}<br>`;}
  }
  finalBox.innerHTML=html;
}
</script>
</body>
</html>
